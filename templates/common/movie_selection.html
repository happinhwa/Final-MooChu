{% extends 'base.html' %}
{% block title %}Movie Select{% endblock %}
{% load static %}
{% block content %}
<head>
    <link rel="stylesheet" href="{% static '/fonts/font.css'%}">
    <link rel="stylesheet" href="{% static 'style-genre.css'%}">
    <style>
        @import 
        url(//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css);
        .rate { display: inline-block;border: 0;margin-right: 15px; width: 120px;}
        .rate > input {display: none;}
        .rate > label {float: right;color: #ddd}
        .rate > label:before {display: inline-block;font-size: 1.5rem;margin: 0;cursor: pointer;font-family: FontAwesome;content: "\f005 ";}
        .rate .half:before {content: "\f089 "; position: absolute;padding-right: 0;}
        .rate input:checked ~ label, 
        .rate label:hover,.rate label:hover ~ label { color: #96FC72 !important;  } 
        .rate input:checked + .rate label:hover,
        .rate input input:checked ~ label:hover,
        .rate input:checked ~ .rate label:hover ~ label,  
        .rate label:hover ~ input:checked ~ label { color: #96FC72 !important;  } 
        li {
            font-family: 'NanumBarunpen';
            color:#96FC72;
            display: flex;
            white-space: nowrap;
            border: 2px solid #96FC72; /* 테두리 추가 */
            padding: 10px; /* 안쪽 여백 추가 */
            border-radius: 5px; /* 테두리 둥글게 설정 */
            margin-top: 12px;
            text-align: left;
            margin-bottom: 12px;
            justify-content: space-between;
            width: 40%; /* 박스 크기 */
            margin: 0 auto; /* 박스를 페이지 가운데로 위치시킴 */
        }
        fieldset.rate {
            display: inline-block;
            border: 0;
            margin-right: 15px;
            float: left; /* 추가된 스타일 - 별점 왼쪽 정렬 */
        }
        img.poster {
            width: 125px; /* 원하는 너비로 변경 */
            height: 200px; /* 원하는 높이로 변경 */
            object-fit: cover; /* 이미지 비율을 유지하면서 고정된 크기에 맞춤 */
        }
    </style>

</head>

<h1 style="font-family: 'NanumBarunpen'; color:#96FC72; margin-bottom: 50px; text-align: center;">Movie List</h1>
<ul>
    <form method="post" action="{% url 'common:movie_selection' %}">
        {% for movie in movies %}
            <li>
                <div>
                    <img src="{% static movie.title|add:'.jpg' %}" class="poster">
                </div>
                <div> 
                    <div style="display: flex; flex-direction: column;">
                        <!-- 영화 정보를 포함하는 div 태그 -->
                        <div>
                            {{ movie.title }} <br>
                            ({{ movie.info }}) <br>
                        </div>
                        <!-- 별점 div -->
                        
                        {% csrf_token %}
                        <input type="hidden" name="movie_title_{{ movie.m_id }}" value="{{ movie.title }}">
                        <div class="rate">
                            {% with forloop.counter as movie_id %}  {# 고유한 영화 ID 생성 #}
                            <input type="radio" id="rating10_{{ movie.m_id }}" name="rating_{{ movie.m_id }}" value="10"><label for="rating10_{{ movie.m_id }}" title="5점"></label>
                            <input type="radio" id="rating9_{{ movie.m_id }}" name="rating_{{ movie.m_id }}" value="9"><label class="half" for="rating9_{{ movie.m_id }}" title="4.5점"></label>
                            <input type="radio" id="rating8_{{ movie.m_id }}" name="rating_{{ movie.m_id }}" value="8"><label for="rating8_{{ movie.m_id }}" title="4점"></label>
                            <input type="radio" id="rating7_{{ movie.m_id }}" name="rating_{{ movie.m_id }}" value="7"><label class="half" for="rating7_{{ movie.m_id }}" title="3.5점"></label>
                            <input type="radio" id="rating6_{{ movie.m_id }}" name="rating_{{ movie.m_id }}" value="6"><label for="rating6_{{ movie.m_id }}" title="3점"></label>
                            <input type="radio" id="rating5_{{ movie.m_id }}" name="rating_{{ movie.m_id }}" value="5"><label class="half" for="rating5_{{ movie.m_id }}" title="2.5점"></label>
                            <input type="radio" id="rating4_{{ movie.m_id }}" name="rating_{{ movie.m_id }}" value="4"><label for="rating4_{{ movie.m_id }}" title="2점"></label>
                            <input type="radio" id="rating3_{{ movie.m_id }}" name="rating_{{ movie.m_id }}" value="3"><label class="half" for="rating3_{{ movie.m_id }}" title="1.5점"></label>
                            <input type="radio" id="rating2_{{ movie.m_id }}" name="rating_{{ movie.m_id }}" value="2"><label for="rating2_{{ movie.m_id }}" title="1점"></label>
                            <input type="radio" id="rating1_{{ movie.m_id }}" name="rating_{{ movie.m_id }}" value="1"><label class="half" for="rating1_{{ movie.m_id }}" title="0.5점"></label>
                            {% endwith %}
                        </div>
                    </div>
                </div>
            </li>
        {% endfor %}
        <input type="submit" value="Save Rating">
    </form>
</ul>
{% endblock %}



{% comment %} {% extends 'base.html' %}style="font-family: 'NanumBarunpen'; color:#96FC72;
{% block title %}genre select{% endblock %}
{% load static %}
{% block content %}
<head>
  <link rel="stylesheet" href="{% static '/fonts/font.css'%}">
  <link rel="stylesheet" href="{% static 'style-genre.css'%}">
</head>

<div class="container" style="margin-top: 20px;">
  <div class="row justify-content-center">
    <h1 style="font-family: 'NanumBarunpen'; color:#96FC72; margin-bottom: 50px; text-align: center;">관심 장르 선택</h1>
    {% for genre in genres %}
      <div class="col-md-4 mb-3 d-flex justify-content-center">
        <button class="genre-button">{{ genre.genre }}</button>
      </div>
      {% if forloop.counter|divisibleby:3 and not forloop.last %}
        </div><div class="row justify-content-center">
      {% endif %}
    {% endfor %}
  </div>


  <br><br><br>
  <div class="row justify-content-end">
    <div class="col-auto">
      <button class="next-btn" id="next-button">다음</button>
    </div>
  </div>  
</div>


{% block script %}
<style>
  .selected {
    background-color: #96FC72;
  }
</style>
<script>
  const genreButtons = document.querySelectorAll(".genre-button");
  const nextButton = document.getElementById("next-button");
  let selectedGenres = [];

  genreButtons.forEach((button) => {
    button.addEventListener("click", () => {
      const genre = button.textContent;
      if (!button.classList.contains("selected")) {
        button.classList.add("selected");
        selectedGenres.push(genre);
      } else {
        button.classList.remove("selected");
        selectedGenres = selectedGenres.filter((item) => item !== genre);
      }
    });
  });

  nextButton.addEventListener("click", () => {
    // POST 요청을 보내고 JsonResponse를 기다림
    const xhr = new XMLHttpRequest();
    xhr.open("POST", "/save_fav_genres/");
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

    // csrf 토큰이 필요한 경우 토큰 값을 가져옵니다.
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    xhr.setRequestHeader("X-CSRFToken", csrfToken);

    xhr.onload = () => {
        if (xhr.status === 200) {
            const response = JSON.parse(xhr.responseText);
            if (response.status === "success") {
                // 성공 응답 받기
                console.log("Data saved successfully!");
            } else {
                // 오류 응답 받기
                console.log("Error saving data!");
            }
            // JsonResponse에 따라 movie_selection 페이지로 이동
            location.href = "movie_selection/";
        }
    };

    // 데이터 전송
    const data = new URLSearchParams();
    selectedGenres.forEach((genre) => {
        data.append('selected_genres[]', genre);
    });
    xhr.send(data.toString());
});

</script>
{% endblock %} 


{% endblock %}  직전에 잘 됐던것{% endcomment %}
