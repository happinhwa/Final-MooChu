{% extends 'base_my.html' %}
{% block title %}mypage{% endblock %}
{% load static %}
<!-- Navbar -->
{% include "navbar/navbar1.html" %}
.
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>My page-book</title>
    <link rel="stylesheet" href="{% static 'font.css' %}">
    <link rel="stylesheet" href="{% static 'mypage.css' %}">

{% block content %}
<div class="bookcover">
  <div class="bookdot">
    <div class="page">
        <!-- 왼쪽 프로필 페이지 구성요소 -->
        {% include "mypage/profile.html" %}




          <div class="content-container">
            <div class="header content-title">
              <div class="content-title-name">{{ user.nickname }}님의 마이페이지</div>
            </div>
            
              <!-- 오른쪽 페이지 구성 -->
            <div class="box content-box"> 
              <div class="scroll-box">
                <div class="box-title">"{{ master.nickname }}"에게 </div>
                <div class="content-note main-section">
                  <div class="guest-note">
                    <div class="guest-info">작성칸&nbsp;
                    </div>
                    <div class="write-guestnote-form">
                      <div class="guest-content">
                        <div class="guest-profile">
                            <img class="guest-image" src="{{ writer.profile_img.url }}" alt="방명록 프로필">
                        </div>
                        <div class="form-container">
                          <form method="POST" action="{% url 'mypage:book' nickname=master.nickname %}">
                            {% csrf_token %}
                            <textarea name="content" rows="5" maxlength="500" required></textarea>
                            <button class="button-input"type="submit">작성 완료</button>
                          </form>
                        </div>
                      </div>
                    
                    </div>
                  </div>
                </div>
                <div class="box-title" style="margin-top: 15px;">"{{ master.nickname }}"님의 방명록 ~</div>
                {% if book %}
                {% for book in book %}
                <div class="content-note main-section">
                  <div class="guest-note">
                      <div class="guest-info">NO. {{ forloop.counter }}&nbsp;
                        <span class="span-note">{{ book.writer.nickname }}</span>&nbsp;
                        {{ book.created_at }}
                        {% if book.writer.id == writer.id or writer.id == master.id %}
                        <form id="delete-form" data-url="{% url 'mypage:book_detail' guestbook_id=book.id %}">
                          {% csrf_token %}
                          <button type="button" class="delete-button">삭제</button>
                        </form>                     
                        {% endif %}
                      </div>
                      <div class="guest-content">
                          <div class="guest-profile">
                              <a href="{% url 'mypage:home' nickname=book.writer.nickname %}"><img class="guest-image" src="{{ book.writer.profile_img.url }}" alt="방명록 프로필"></a>
                          </div>
                          <div class="guest-message">
                              {{ book.content }}
                          </div>
                      </div>
                  </div>
                </div>
                {% endfor %}
                {% else %}
                  <h3> 작성된 방명록이 없습니다.</h3>
                {% endif %}
                
                
              </div>
            </div>
            <div class="content-note main-section">
              <div class="guest-note">
                  <div class="guest-info">no.152&nbsp;
                    <span class="span-note">개미</span>&nbsp;
                    (2010.01.24 19:44)
                    <button class="delete-button">삭제</button>
                  </div>
                  <div class="guest-content">
                      <div class="guest-profile">
                          <img class="guest-image" src="/static/abc.jpeg" alt="방명록 프로필">
                      </div>
                      <div class="guest-message">
                          갑자기 미안한데 나도 참다참다 말한다.<br>
                          너 자꾸 사람 화나게 하는 구석이 있다?<br>
                          자꾸 이런식이여서 나한테 감정이 쌓이고 쌓이고 쌓이면<br><br>
                          싸이먼 도미닉<br>
                      </div>
                  </div>
              </div>
            </div>
            {% endfor %}

          </div>
        </div>
      </div>
      <!-- 메뉴 버튼 구성 요소-->
      {% include "mypage/menu.html" %}

    </div>
  </body>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      $('.delete-button').click(function() {
        var csrftoken = $("[name=csrfmiddlewaretoken]").val();
        var url = $(this).closest('form').data('url');

        $.ajax({
          url: url,
          type: 'DELETE',
          beforeSend: function(xhr) {
            xhr.setRequestHeader('X-CSRFToken', csrftoken);
          },
          success: function() {
            // 삭제 성공한 후 수행할 동작을 추가하세요
            // 예: 페이지 새로고침 등
            location.reload();
          },
          error: function(xhr, status, error) {
            console.error('Failed to delete book:', error);
          }
        });
      });
    });
  </script>
</html>

